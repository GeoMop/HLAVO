# syntax=docker/dockerfile:1.6
ARG BASE_IMAGE=flow123d/hlavo:latest
FROM ${BASE_IMAGE}

# ---- Configurable versions ----
ARG NODE_MAJOR=22

USER root

# ---- Install Node.js (for npm) + Codex CLI ----
RUN set -eux; \
    apt-get update; \
    apt-get install -y --no-install-recommends ca-certificates curl gnupg; \
    curl -fsSL "https://deb.nodesource.com/setup_${NODE_MAJOR}.x" | bash -; \
    apt-get update; \
    apt-get install -y --no-install-recommends nodejs; \
    npm i -g @openai/codex; \
    rm -rf /var/lib/apt/lists/*

# ---- Codex config dir ----
# (base image already has user hlavo; create config with correct ownership)
RUN set -eux; \
    mkdir -p /home/hlavo/.codex; \
    chown -R hlavo:hlavo /home/hlavo/.codex; \
    chmod 0775 /home/hlavo; \
    chmod 0775 /home/hlavo/.codex

USER hlavo
WORKDIR /workspace
CMD ["bash"]
