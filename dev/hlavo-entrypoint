#!/usr/bin/env bash
set -euo pipefail

USER_NAME="hlavo"
TARGET_UID="${HLAVO_UID:?HLAVO_UID not set}"
TARGET_GID="${HLAVO_GID:?HLAVO_GID not set}"

if [[ $# -eq 0 ]]; then
  set -- bash
fi

if [[ "$(id -u)" -ne 0 ]]; then
  exec "$@"
fi

groupmod -g "$TARGET_GID" "$USER_NAME" >/dev/null 2>&1 || true
usermod -u "$TARGET_UID" "$USER_NAME" >/dev/null 2>&1 || true
usermod -g "$TARGET_GID" "$USER_NAME" >/dev/null 2>&1 || true

exec su -s /bin/bash "$USER_NAME" -c "$(printf '%q ' "$@")"
