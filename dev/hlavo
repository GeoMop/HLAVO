#!/usr/bin/env bash
set -euo pipefail

SCRIPT_ROOT="$( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"

if [[ "${1:-}" == "-c" ]]; then
  HLAVO_MODE="conda"
  shift
fi

source "$SCRIPT_ROOT/hlavo_common.sh"

usage() {
  cat <<'EOF'
Usage:
  ./hlavo run <command> [args...]
  ./hlavo shell
  ./hlavo venv [-f]
EOF
}

[[ $# -ge 1 ]] || { usage; exit 1; }
subcmd="$1"
shift || true

case "$subcmd" in
  venv)
    venv_ensure "${1:-}"
    venv_overlay
    ;;
  shell)
    run_cmd "${SHELL:-bash}" -i
    ;;
  run)
    run_cmd "$@"
    ;;
  *)
    usage
    die "Unknown subcommand: $subcmd"
    ;;
esac
