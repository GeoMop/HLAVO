#!/usr/bin/env bash
set -xeuo pipefail

SCRIPT_ROOT="$( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"

while [[ "${1:-}" == -* ]]; do
  case "$1" in
    -c)
      HLAVO_MODE="conda"
      shift
      ;;
    -t)
      tty_arg="-it"
      shift
      ;;
    *)
      break
      ;;
  esac
done

source "$SCRIPT_ROOT/hlavo_common.sh"

usage() {
  cat <<'EOF'
Usage:
  ./hlavo run <command> [args...]
  ./hlavo shell
  ./hlavo venv [-f]
  ./hlavo -t run <command> [args...]
  ./hlavo -t shell
EOF
}

[[ $# -ge 1 ]] || { usage; exit 1; }
subcmd="$1"
shift || true

case "$subcmd" in
  shell)
    run_cmd "${SHELL:-bash}" -i
    ;;
  run)
    run_cmd "$@"
    ;;
  *)
    usage
    die "Unknown subcommand: $subcmd"
    ;;
esac
